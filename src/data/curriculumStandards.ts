import { CommonStandard } from "@/types/gradeStandards";

// Math Standards
export const mathStandards: CommonStandard[] = [
  {
    id: "math-1-oa-1",
    code: "1.OA.1",
    title: "Addition and subtraction within 20",
    description:
      "Use addition and subtraction within 20 to solve word problems involving situations of adding to, taking from, putting together, taking apart, and comparing, with unknowns in all positions, e.g., by using objects, drawings, and equations with a symbol for the unknown number to represent the problem.",
    subject: "mathematics",
    grade: 1,
    domain: "Operations and Algebraic Thinking",
    cluster: "Represent and solve problems involving addition and subtraction.",
  },
  {
    id: "math-1-oa-6",
    code: "1.OA.6",
    title: "Add and subtract within 20",
    description:
      "Add and subtract within 20, demonstrating fluency for addition and subtraction within 10. Use strategies such as counting on; making ten (e.g., 8 + 6 = 8 + 2 + 4 = 10 + 4 = 14); decomposing a number leading to ten (e.g., 13 – 4 = 13 – 3 – 1 = 10 – 1 = 9); using the relationship between addition and subtraction (e.g., knowing that 8 + 4 = 12, one knows 12 – 8 = 4); and creating equivalent but easier or known sums (e.g., adding 6 + 7 by creating the known equivalent 6 + 6 + 1 = 12 + 1 = 13).",
    subject: "mathematics",
    grade: 1,
    domain: "Operations and Algebraic Thinking",
    cluster: "Understand and apply properties of operations and the relationship between addition and subtraction.",
  },
  {
    id: "math-2-oa-2",
    code: "2.OA.2",
    title: "Fluently add and subtract within 20",
    description:
      "Fluently add and subtract within 20 using mental strategies. By end of Grade 2, know from memory all sums of two one-digit numbers.",
    subject: "mathematics",
    grade: 2,
    domain: "Operations and Algebraic Thinking",
    cluster: "Add and subtract within 20.",
  },
  {
    id: "math-3-oa-7",
    code: "3.OA.7",
    title: "Fluently multiply and divide within 100",
    description:
      "Fluently multiply and divide within 100, using strategies such as the relationship between multiplication and division (e.g., knowing that 8 × 5 = 40, one knows 40 ÷ 5 = 8) or properties of operations. By the end of Grade 3, know from memory all products of two one-digit numbers.",
    subject: "mathematics",
    grade: 3,
    domain: "Operations and Algebraic Thinking",
    cluster: "Multiply and divide within 100.",
  },
  {
    id: "math-4-nf-3",
    code: "4.NF.3",
    title: "Understand addition and subtraction of fractions",
    description:
      "Understand a fraction a/b with a > 1 as a sum of fractions 1/b.",
    subject: "mathematics",
    grade: 4,
    domain: "Number and Operations—Fractions",
    cluster: "Build fractions from unit fractions by applying and extending previous understandings of operations on whole numbers.",
  },
  {
    id: "math-5-nf-1",
    code: "5.NF.1",
    title: "Add and subtract fractions with unlike denominators",
    description:
      "Add and subtract fractions with unlike denominators (including mixed numbers) by replacing given fractions with equivalent fractions in such a way as to produce an equivalent sum or difference of fractions with like denominators.",
    subject: "mathematics",
    grade: 5,
    domain: "Number and Operations—Fractions",
    cluster: "Use equivalent fractions as a strategy to add and subtract fractions.",
  },
  {
    id: "math-6-rp-3",
    code: "6.RP.3",
    title: "Use ratio and rate reasoning to solve real-world problems",
    description:
      "Use ratio and rate reasoning to solve real-world and mathematical problems, e.g., by reasoning about tables of equivalent ratios, tape diagrams, double number line diagrams, or equations.",
    subject: "mathematics",
    grade: 6,
    domain: "Ratios and Proportional Relationships",
    cluster:
      "Understand ratio concepts and use ratio reasoning to solve problems.",
  },
  {
    id: "math-7-rp-2",
    code: "7.RP.2",
    title: "Recognize and represent proportional relationships",
    description:
      "Recognize and represent proportional relationships between quantities.",
    subject: "mathematics",
    grade: 7,
    domain: "Ratios and Proportional Relationships",
    cluster: "Analyze proportional relationships and use them to solve real-world and mathematical problems.",
  },
  {
    id: "math-8-ee-7",
    code: "8.EE.7",
    title: "Solve linear equations in one variable",
    description:
      "Solve linear equations in one variable. a. Give examples of linear equations in one variable with one solution, infinitely many solutions, or no solutions. Show which of these possibilities is the case by successively transforming the given equation into simpler forms, until an equivalent equation of the form x = a, a = a, or a = b results (where a and b are different numbers). b. Solve linear equations with rational number coefficients, including equations whose solutions require expanding expressions using the distributive property and collecting like terms.",
    subject: "mathematics",
    grade: 8,
    domain: "Expressions and Equations",
    cluster: "Analyze and solve linear equations and pairs of simultaneous linear equations.",
  },
  {
    id: "math-hs-n-rn-2",
    code: "HSN-RN.2",
    title:
      "Rewrite expressions involving radicals and rational exponents using the properties of exponents",
    description:
      "Rewrite expressions involving radicals and rational exponents using the properties of exponents",
    subject: "mathematics",
    grade: 9,
    domain: "Number and Quantity",
    cluster: "Extend the properties of exponents to rational exponents.",
  },
];

// English Standards
export const englishStandards: CommonStandard[] = [
  {
    id: "ela-1-rl-1",
    code: "1.RL.1",
    title: "Ask and answer questions about key details in a text",
    description:
      "Ask and answer questions about key details in a text. (Literature)",
    subject: "english",
    grade: 1,
    domain: "Reading: Literature",
    cluster: "Key Ideas and Details",
  },
  {
    id: "ela-2-ri-3",
    code: "2.RI.3",
    title: "Describe the connection between a series of historical events",
    description:
      "Describe the connection between a series of historical events, scientific ideas or concepts, or steps in technical procedures in a text. (Informational Text)",
    subject: "english",
    grade: 2,
    domain: "Reading: Informational Text",
    cluster: "Key Ideas and Details",
  },
  {
    id: "ela-3-w-2",
    code: "3.W.2",
    title: "Write informative/explanatory texts to examine a topic",
    description:
      "Write informative/explanatory texts to examine a topic and convey ideas and information clearly.",
    subject: "english",
    grade: 3,
    domain: "Writing",
    cluster: "Text Types and Purposes",
  },
  {
    id: "ela-4-l-3",
    code: "4.L.3",
    title: "Use knowledge of language and its conventions when writing",
    description:
      "Use knowledge of language and its conventions when writing, speaking, reading, or listening.",
    subject: "english",
    grade: 4,
    domain: "Language",
    cluster: "Conventions of Standard English",
  },
  {
    id: "ela-5-r-7",
    code: "5.R.7",
    title: "Analyze how visual and multimedia elements contribute to meaning",
    description:
      "Analyze how visual and multimedia elements contribute to the meaning, tone, or beauty of a text (e.g., graphic novel, multimedia presentation).",
    subject: "english",
    grade: 5,
    domain: "Reading",
    cluster: "Integration of Knowledge and Ideas",
  },
  {
    id: "ela-6-w-1",
    code: "6.W.1",
    title: "Write arguments to support claims with clear reasons",
    description:
      "Write arguments to support claims with clear reasons and relevant evidence.",
    subject: "english",
    grade: 6,
    domain: "Writing",
    cluster: "Text Types and Purposes",
  },
  {
    id: "ela-7-ri-1",
    code: "7.RI.1",
    title: "Cite several pieces of textual evidence to support analysis",
    description:
      "Cite several pieces of textual evidence to support analysis of what the text says explicitly as well as inferences drawn from the text.",
    subject: "english",
    grade: 7,
    domain: "Reading: Informational Text",
    cluster: "Key Ideas and Details",
  },
  {
    id: "ela-8-l-5",
    code: "8.L.5",
    title: "Demonstrate understanding of figurative language",
    description:
      "Demonstrate understanding of figurative language, word relationships, and nuances in word meanings.",
    subject: "english",
    grade: 8,
    domain: "Language",
    cluster: "Vocabulary Acquisition and Use",
  },
  {
    id: "ela-9-10-r-3",
    code: "9-10.R.3",
    title:
      "Analyze how complex characters develop over the course of a text",
    description:
      "Analyze how complex characters (e.g., those with multiple or conflicting motivations) develop over the course of a text, interact with other characters, and advance the plot or develop the theme.",
    subject: "english",
    grade: 9,
    domain: "Reading",
    cluster: "Key Ideas and Details",
  },
  {
    id: "ela-11-12-w-2",
    code: "11-12.W.2",
    title: "Write informative/explanatory texts to examine and convey ideas",
    description:
      "Write informative/explanatory texts to examine and convey complex ideas, concepts, and information clearly and accurately through the effective selection, organization, and analysis of content.",
    subject: "english",
    grade: 11,
    domain: "Writing",
    cluster: "Text Types and Purposes",
  },
];

// Science Standards
export const scienceStandards: CommonStandard[] = [
  {
    id: "sci-k-ps2-1",
    code: "K-PS2-1",
    title:
      "Plan and conduct an investigation to compare the effects of different strengths or different directions of pushes and pulls on the motion of an object.",
    description:
      "Plan and conduct an investigation to compare the effects of different strengths or different directions of pushes and pulls on the motion of an object.",
    subject: "science",
    grade: 0,
    domain: "Physical Science",
    cluster: "Motion and Stability: Forces and Interactions",
  },
  {
    id: "sci-1-ls1-1",
    code: "1-LS1-1",
    title:
      "Use observations to describe patterns of what plants and animals (including humans) need to survive.",
    description:
      "Use observations to describe patterns of what plants and animals (including humans) need to survive.",
    subject: "science",
    grade: 1,
    domain: "Life Science",
    cluster: "From Molecules to Organisms: Structures and Processes",
  },
  {
    id: "sci-2-ess2-1",
    code: "2-ESS2-1",
    title:
      "Compare different solutions to reduce the impacts of humans on the land, water, air, and/or other living things in the local environment.",
    description:
      "Compare different solutions to reduce the impacts of humans on the land, water, air, and/or other living things in the local environment.",
    subject: "science",
    grade: 2,
    domain: "Earth and Space Science",
    cluster: "Earth's Systems",
  },
  {
    id: "sci-3-ls3-1",
    code: "3-LS3-1",
    title:
      "Analyze and interpret data to provide evidence that plants and animals have traits inherited from parents and that variation of these traits exists in a group of similar organisms.",
    description:
      "Analyze and interpret data to provide evidence that plants and animals have traits inherited from parents and that variation of these traits exists in a group of similar organisms.",
    subject: "science",
    grade: 3,
    domain: "Life Science",
    cluster: "Heredity: Inheritance and Variation of Traits",
  },
  {
    id: "sci-4-ps4-1",
    code: "4-PS4-1",
    title:
      "Develop a model of waves to describe patterns of waves in terms of amplitude and wavelength and that waves can cause objects to move.",
    description:
      "Develop a model of waves to describe patterns of waves in terms of amplitude and wavelength and that waves can cause objects to move.",
    subject: "science",
    grade: 4,
    domain: "Physical Science",
    cluster: "Waves and Their Applications in Technologies for Information Transfer",
  },
  {
    id: "sci-5-ess1-1",
    code: "5-ESS1-1",
    title:
      "Support an argument that differences in the apparent brightness of the sun compared to other stars is due to their relative distances from Earth.",
    description:
      "Support an argument that differences in the apparent brightness of the sun compared to other stars is due to their relative distances from Earth.",
    subject: "science",
    grade: 5,
    domain: "Earth and Space Science",
    cluster: "Earth's Place in the Universe",
  },
  {
    id: "sci-ms-ps1-1",
    code: "MS-PS1-1",
    title:
      "Develop models to describe the atomic composition of simple molecules and extended structures.",
    description:
      "Develop models to describe the atomic composition of simple molecules and extended structures.",
    subject: "science",
    grade: 6,
    domain: "Physical Science",
    cluster: "Matter and Its Interactions",
  },
  {
    id: "sci-ms-ls2-1",
    code: "MS-LS2-1",
    title:
      "Analyze and interpret data to provide evidence for the effects of resource availability on organisms and populations of organisms in an ecosystem.",
    description:
      "Analyze and interpret data to provide evidence for the effects of resource availability on organisms and populations of organisms in an ecosystem.",
    subject: "science",
    grade: 7,
    domain: "Life Science",
    cluster: "Ecosystems: Interactions, Energy, and Dynamics",
  },
  {
    id: "sci-ms-ess3-3",
    code: "MS-ESS3-3",
    title:
      "Apply scientific principles to design a method for monitoring and minimizing a human impact on the environment.",
    description:
      "Apply scientific principles to design a method for monitoring and minimizing a human impact on the environment.",
    subject: "science",
    grade: 8,
    domain: "Earth and Space Science",
    cluster: "Earth and Human Activity",
  },
  {
    id: "sci-hs-ps1-1",
    code: "HS-PS1-1",
    title:
      "Use the periodic table as a model to predict the relative properties of elements based on the patterns of electrons in the outermost energy level of atoms.",
    description:
      "Use the periodic table as a model to predict the relative properties of elements based on the patterns of electrons in the outermost energy level of atoms.",
    subject: "science",
    grade: 9,
    domain: "Physical Science",
    cluster: "Matter and Its Interactions",
  },
];

// Social Studies Standards
export const socialStudiesStandards: CommonStandard[] = [
  {
    id: "ss-k-g-1",
    code: "K.G.1",
    title: "Use maps and other geographic tools",
    description: "Use maps and other geographic tools to identify locations.",
    subject: "social-studies",
    grade: 0,
    domain: "Geography",
    cluster: "The World in Spatial Terms",
  },
  {
    id: "ss-1-h-1",
    code: "1.H.1",
    title: "Understand how events relate to one another in time",
    description:
      "Understand how events relate to one another in time. (History)",
    subject: "social-studies",
    grade: 1,
    domain: "History",
    cluster: "Time, Continuity, and Change",
  },
  {
    id: "ss-2-c-2",
    code: "2.C.2",
    title: "Identify the rights and responsibilities of citizens",
    description:
      "Identify the rights and responsibilities of citizens. (Civics)",
    subject: "social-studies",
    grade: 2,
    domain: "Civics",
    cluster: "Civic Ideals and Practices",
  },
  {
    id: "ss-3-e-3",
    code: "3.E.3",
    title: "Explain how people in a community make choices",
    description:
      "Explain how people in a community make choices to produce goods and services. (Economics)",
    subject: "social-studies",
    grade: 3,
    domain: "Economics",
    cluster: "Production, Distribution, and Consumption",
  },
  {
    id: "ss-4-g-4",
    code: "4.G.4",
    title: "Analyze the human and physical characteristics of regions",
    description:
      "Analyze the human and physical characteristics of regions. (Geography)",
    subject: "social-studies",
    grade: 4,
    domain: "Geography",
    cluster: "Human Systems",
  },
  {
    id: "ss-5-h-5",
    code: "5.H.5",
    title: "Explain the causes and consequences of exploration",
    description:
      "Explain the causes and consequences of exploration and colonization. (History)",
    subject: "social-studies",
    grade: 5,
    domain: "History",
    cluster: "Time, Continuity, and Change",
  },
  {
    id: "ss-6-c-6",
    code: "6.C.6",
    title: "Evaluate the roles, rights, and responsibilities of citizens",
    description:
      "Evaluate the roles, rights, and responsibilities of citizens in various societies. (Civics)",
    subject: "social-studies",
    grade: 6,
    domain: "Civics",
    cluster: "Civic Ideals and Practices",
  },
  {
    id: "ss-7-e-7",
    code: "7.E.7",
    title: "Analyze economic systems",
    description:
      "Analyze economic systems and their impact on resource allocation. (Economics)",
    subject: "social-studies",
    grade: 7,
    domain: "Economics",
    cluster: "Production, Distribution, and Consumption",
  },
  {
    id: "ss-8-g-8",
    code: "8.G.8",
    title: "Analyze the interactions between humans and the environment",
    description:
      "Analyze the interactions between humans and the environment. (Geography)",
    subject: "social-studies",
    grade: 8,
    domain: "Geography",
    cluster: "Environment and Society",
  },
  {
    id: "ss-9-12-h-9",
    code: "9-12.H.9",
    title: "Evaluate historical sources",
    description:
      "Evaluate historical sources for accuracy, bias, and perspective. (History)",
    subject: "social-studies",
    grade: 9,
    domain: "History",
    cluster: "Historical Skills",
  },
];

// Computer Science Standards
export const computerScienceStandards: CommonStandard[] = [
  {
    id: "cs-k-2-ap-1",
    code: "K-2.AP.1",
    title: "Model daily processes by creating and following algorithms",
    description:
      "Model daily processes by creating and following algorithms (sets of step-by-step instructions) to complete tasks.",
    subject: "computer-science",
    grade: 0,
    domain: "Algorithms and Programming",
    cluster: "Algorithms",
  },
  {
    id: "cs-3-5-cd-2",
    code: "3-5.CD.2",
    title:
      "Describe how internal and external parts of computing devices function to form a system.",
    description:
      "Describe how internal and external parts of computing devices function to form a system.",
    subject: "computer-science",
    grade: 3,
    domain: "Computing Devices",
    cluster: "Hardware and Software",
  },
  {
    id: "cs-6-8-ni-3",
    code: "6-8.NI.3",
    title:
      "Explain how network devices work together to form the Internet.",
    description:
      "Explain how network devices work together to form the Internet.",
    subject: "computer-science",
    grade: 6,
    domain: "Networks and the Internet",
    cluster: "Network Communication and Organization",
  },
  {
    id: "cs-9-12-ap-4",
    code: "9-12.AP.4",
    title:
      "Evaluate and refine algorithms to improve efficiency and usability.",
    description:
      "Evaluate and refine algorithms to improve efficiency and usability.",
    subject: "computer-science",
    grade: 9,
    domain: "Algorithms and Programming",
    cluster: "Algorithms",
  },
  {
    id: "cs-k-2-da-5",
    code: "K-2.DA.5",
    title: "Store, copy, search, retrieve, modify, and delete data",
    description:
      "Store, copy, search, retrieve, modify, and delete data using a computing device and define the attributes of the data.",
    subject: "computer-science",
    grade: 0,
    domain: "Data and Analysis",
    cluster: "Collection, Visualization, and Transformation",
  },
  {
    id: "cs-3-5-ap-6",
    code: "3-5.AP.6",
    title:
      "Decompose problems into smaller, manageable subproblems to facilitate the program development process.",
    description:
      "Decompose problems into smaller, manageable subproblems to facilitate the program development process.",
    subject: "computer-science",
    grade: 3,
    domain: "Algorithms and Programming",
    cluster: "Program Development",
  },
  {
    id: "cs-6-8-si-7",
    code: "6-8.SI.7",
    title:
      "Identify and correct errors in algorithms and programs, including syntax and logic errors.",
    description:
      "Identify and correct errors in algorithms and programs, including syntax and logic errors.",
    subject: "computer-science",
    grade: 6,
    domain: "System Interactions",
    cluster: "Human-Computer Interaction",
  },
  {
    id: "cs-9-12-ap-8",
    code: "9-12.AP.8",
    title:
      "Evaluate algorithms in terms of their efficiency, correctness, and clarity.",
    description:
      "Evaluate algorithms in terms of their efficiency, correctness, and clarity.",
    subject: "computer-science",
    grade: 9,
    domain: "Algorithms and Programming",
    cluster: "Algorithms",
  },
];

// Safely access standards data with proper type checking
export const getStandardsBySubject = (subject: string) => {
  const subjectMap: Record<string, any> = {
    mathematics: mathStandards,
    english: englishStandards,
    science: scienceStandards,
    'social-studies': socialStudiesStandards,
    'computer-science': computerScienceStandards
  };
  
  return subjectMap[subject.toLowerCase()] || [];
};

export const getAllStandards = () => {
  return [
    ...mathStandards,
    ...englishStandards,
    ...scienceStandards,
    ...socialStudiesStandards,
    ...computerScienceStandards
  ];
};

export const getStandardById = (id: string) => {
  const allStandards = getAllStandards();
  return allStandards.find(standard => standard && typeof standard === 'object' && 'id' in standard && standard.id === id);
};

export const getStandardsByGrade = (grade: number) => {
  const allStandards = getAllStandards();
  return allStandards.filter(standard => 
    standard && 
    typeof standard === 'object' && 
    'grade' in standard && 
    standard.grade === grade
  );
};

// Safe curriculum loading with type validation
export const loadCurriculumData = async () => {
  try {
    const response = await fetch('/data/common-standards.json');
    const data = await response.json();
    
    // Validate that data is an array
    if (!Array.isArray(data)) {
      console.warn('Curriculum data is not an array, using fallback');
      return getAllStandards();
    }

    // Filter and validate each standard
    return data.filter((item: unknown): item is CommonStandard => {
      if (!item || typeof item !== 'object') return false;
      
      const standard = item as any;
      return (
        typeof standard.id === 'string' &&
        typeof standard.title === 'string' &&
        typeof standard.description === 'string' &&
        typeof standard.subject === 'string' &&
        typeof standard.grade === 'number'
      );
    }).map((item: any) => ({
      id: item.id,
      code: item.code || '',
      title: item.title,
      description: item.description,
      subject: item.subject,
      grade: item.grade,
      domain: item.domain || item.cluster || '',
      cluster: item.cluster || item.domain || ''
    } as CommonStandard));

  } catch (error) {
    console.error('Error loading curriculum data:', error);
    return getAllStandards();
  }
};

// Enhanced search with safe type checking
export const searchStandards = (query: string): CommonStandard[] => {
  const allStandards = getAllStandards();
  const searchTerm = query.toLowerCase();
  
  return allStandards.filter((standard: any) => {
    if (!standard || typeof standard !== 'object') return false;
    
    const title = standard.title?.toLowerCase() || '';
    const description = standard.description?.toLowerCase() || '';
    const subject = standard.subject?.toLowerCase() || '';
    
    return title.includes(searchTerm) || 
           description.includes(searchTerm) || 
           subject.includes(searchTerm);
  });
};

// Safe filtering by subject and grade
export const getFilteredStandards = (subject?: string, grade?: number): CommonStandard[] => {
  let standards = getAllStandards();
  
  if (subject) {
    standards = standards.filter((standard: any) => 
      standard && 
      typeof standard === 'object' && 
      'subject' in standard &&
      standard.subject?.toLowerCase() === subject.toLowerCase()
    );
  }
  
  if (grade !== undefined) {
    standards = standards.filter((standard: any) => 
      standard && 
      typeof standard === 'object' && 
      'grade' in standard &&
      standard.grade === grade
    );
  }
  
  return standards;
};

// Export validated standards finder
export const findStandardByCode = (code: string): CommonStandard | undefined => {
  const allStandards = getAllStandards();
  const foundStandard = allStandards.find((standard: any) => 
    standard && 
    typeof standard === 'object' && 
    'code' in standard &&
    standard.code === code
  );
  
  if (foundStandard && typeof foundStandard === 'object') {
    return foundStandard as CommonStandard;
  }
  
  return undefined;
};
